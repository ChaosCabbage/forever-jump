<html>

<head>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        var socket = io()
        var adminSocket = io("/admin")

        socket.on("gamestate", function (gamestate) {
            console.log(JSON.stringify(gamestate))
            const n = Object.keys(gamestate.players).length;
            var board = document.getElementById("leaderboard");
            var go = document.getElementById("go");
            var stop = document.getElementById("stop");

            go.disabled = true;
            stop.disabled = true;

            if (gamestate.state === "WAITING") {
                go.disabled = false;
                board.innerHTML = n + " players waiting."
            } else if (gamestate.state === "JUMPING") {
                stop.disabled = false;
                board.innerHTML = n + "players"
                document.getElementById("go").disabled = true;
                board.append("| winners: " + JSON.stringify(gamestate.winners))
            }
        })

        function beginGame() {
            var goal = parseInt(document.getElementById("goal").value);
            var death = document.getElementById("death").checked;
            adminSocket.emit("begin", { goal: goal, death: death })
        }
        function endGame() {
            adminSocket.emit("stop")
        }
    </script>
</head>

<body>
    <div id="leaderboard">0 players waiting</div>
    <input type="number" id="goal" value="5000" /><br/>
    Death? <input type="checkbox" id="death"><br/>
    <button id="go" onclick="beginGame()">Go</button>
    <button id="stop" onclick="endGame()">Stop</button>
</body>

</html>
